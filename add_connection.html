<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>नया जल कनेक्शन - NPP NAKUR</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', 'Nirmala UI', sans-serif; }
        body { background: #f5f5f5; min-height: 100vh; display: flex; flex-direction: column; }

        .header {
            background: white; color: #333; padding: 15px 30px; display: flex;
            justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 100; border-bottom: 2px solid #e0e0e0;
        }

        .header a {
            color: #1565c0; text-decoration: none; margin-left: 20px; font-weight: 600;
            display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px;
            border-radius: 6px; transition: all 0.3s; border: 1px solid #e0e0e0;
        }

        .header a:hover { background: #f0f7ff; color: #0d47a1; border-color: #1565c0; }

        .main-container { flex: 1; padding: 25px; display: flex; justify-content: center; align-items: flex-start; position: relative; }

        .form-container {
            width: 100%; max-width: 1000px; background: white; padding: 30px;
            border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;
            margin-bottom: 80px; border: 1px solid #e0e0e0;
        }

        .form-group { margin-bottom: 18px; }
        .full-width { grid-column: span 2; }

        label { font-weight: 600; display: block; margin-bottom: 8px; color: #333; font-size: 14px; }
        input, select {
            width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 6px;
            background: #fafafa; font-size: 15px; transition: all 0.3s;
        }
        input:focus, select:focus { outline: none; border-color: #1565c0; background: white; }

        .total-balance {
            margin-top: 15px; font-weight: bold; color: #2e7d32; background: #f1f8e9;
            padding: 15px; border-radius: 6px; text-align: center; font-size: 18px; border: 1px solid #c5e1a5;
        }

        .submit-btn {
            background: #2e7d32; color: white; padding: 15px; border: none; border-radius: 6px;
            cursor: pointer; font-size: 16px; font-weight: 600; width: 100%;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        .bottom-center-btn {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #ff9800; color: white; padding: 12px 25px; border-radius: 6px;
            text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px; border: none; cursor: pointer;
        }

        .error-message { color: #d32f2f; background: #ffebee; padding: 12px 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #d32f2f; display: none; align-items: center; gap: 10px; }
        .success-message { color: #388e3c; background: #e8f5e9; padding: 12px 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #388e3c; display: none; align-items: center; gap: 10px; }

        @media (max-width: 768px) {
            .form-container { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
            .header { flex-direction: column; padding: 15px; }
        }
    </style>
</head>
<body>

<div class="header">
    <div><strong><i class="fas fa-water" style="color: #1565c0;"></i> नया जल कनेक्शन</strong></div>
    <div style="display: flex;">
        <a href="dashboard.html"><i class="fas fa-home"></i> होम</a>
        <a href="index.html" onclick="localStorage.clear();"><i class="fas fa-sign-out-alt"></i> लॉगआउट</a>
    </div>
</div>

<div class="main-container">
    <div class="form-container">
        <div id="statusBox" class="full-width">
            <div id="errorMsg" class="error-message"><i class="fas fa-exclamation-circle"></i> <span id="errorText"></span></div>
            <div id="successMsg" class="success-message"><i class="fas fa-check-circle"></i> <span id="successText"></span></div>
        </div>

        <form id="waterForm" style="display: contents;">
            <div class="form-group">
                <label for="con_no"><i class="fas fa-id-card"></i> कनेक्शन नंबर*</label>
                <input type="text" id="con_no" required placeholder="जैसे: JL12345">
            </div>

            <div class="form-group">
                <label for="owner"><i class="fas fa-user"></i> स्वामी का नाम*</label>
                <input type="text" id="owner" required placeholder="पूरा नाम दर्ज करें">
            </div>

            <div class="form-group">
                <label for="mobile"><i class="fas fa-mobile-alt"></i> मोबाइल नंबर*</label>
                <input type="tel" id="mobile" maxlength="10" required placeholder="10 अंकों का मोबाइल नंबर">
            </div>

            <div class="form-group">
                <label for="ward_no"><i class="fas fa-map-marker-alt"></i> वार्ड नंबर*</label>
                <input type="number" id="ward_no" required placeholder="वार्ड नंबर दर्ज करें">
            </div>

            <div class="form-group">
                <label for="connection_type"><i class="fas fa-faucet"></i> कनेक्शन प्रकार*</label>
                <select id="connection_type" required>
                    <option value="" disabled selected>चुनें...</option>
                    <option value="Domestic">घरेलू</option>
                    <option value="Commercial">व्यावसायिक</option>
                </select>
            </div>

            <div class="form-group">
                <label for="current_amount"><i class="fas fa-rupee-sign"></i> वर्तमान राशि (2025-26)*</label>
                <input type="number" id="current_amount" step="0.01" value="0.00" oninput="calculateTotal()">
            </div>

            <div class="form-group">
                <label for="arrear_balance"><i class="fas fa-hand-holding-usd"></i> बकाया राशि (पिछला)*</label>
                <input type="number" id="arrear_balance" step="0.01" value="0.00" oninput="calculateTotal()">
            </div>

            <div class="form-group full-width">
                <label for="connection_date_time"><i class="fas fa-calendar-alt"></i> कनेक्शन की तिथि एवं समय*</label>
                <input type="datetime-local" id="connection_date_time" required>
            </div>

            <div class="form-group full-width">
                <div class="total-balance">
                    <strong><i class="fas fa-coins"></i> कुल देय राशि: ₹<span id="totalAmount">0.00</span></strong>
                </div>
            </div>

            <div class="form-group full-width">
                <button type="submit" class="submit-btn">
                    <i class="fas fa-save"></i> कनेक्शन सहेजें
                </button>
            </div>
        </form>
    </div>

    <button onclick="window.location.href='connection_detail.html'" class="bottom-center-btn">
        <i class="fas fa-arrow-left"></i> सूची पर वापस जाएं
    </button>
</div>

<script>
    // --- सुरक्षा जांच ---
    if (localStorage.getItem('isLoggedIn') !== 'true') {
        window.location.replace('index.html');
    }

    function calculateTotal() {
        const curr = parseFloat(document.getElementById("current_amount").value) || 0;
        const arrear = parseFloat(document.getElementById("arrear_balance").value) || 0;
        const total = curr + arrear;
        document.getElementById("totalAmount").textContent = total.toFixed(2);
    }

    // ऑटो डेट सेट करें
    window.onload = function() {
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById("connection_date_time").value = now.toISOString().slice(0, 16);
    };

    // फॉर्म सबमिट हैंडलर
    document.getElementById('waterForm').onsubmit = function(e) {
        e.preventDefault();
        
        const mobile = document.getElementById('mobile').value;
        if (!/^[6-9][0-9]{9}$/.test(mobile)) {
            showMsg('error', 'कृपया वैध 10 अंकों का मोबाइल नंबर दर्ज करें!');
            return;
        }

        const formData = {
            id: Date.now(),
            con_no: document.getElementById('con_no').value,
            owner: document.getElementById('owner').value,
            mobile: mobile,
            ward: document.getElementById('ward_no').value,
            type: document.getElementById('connection_type').value,
            amount: document.getElementById('totalAmount').textContent,
            date: document.getElementById('connection_date_time').value
        };

        // डेटा स्थानीय भंडारण (LocalStorage) में सहेजें
        let connections = JSON.parse(localStorage.getItem('water_connections') || '[]');
        connections.push(formData);
        localStorage.setItem('water_connections', JSON.stringify(connections));

        showMsg('success', 'डेटा सफलतापूर्वक सहेज लिया गया है!');
        
        // रीडायरेक्शन लिंक को jal.html से बदलकर connection_detail.html किया गया
        setTimeout(() => {
            window.location.href = 'connection_detail.html';
        }, 1500);
    };

    function showMsg(type, text) {
        document.getElementById('errorMsg').style.display = 'none';
        document.getElementById('successMsg').style.display = 'none';
        
        if(type === 'error') {
            document.getElementById('errorText').innerText = text;
            document.getElementById('errorMsg').style.display = 'flex';
        } else {
            document.getElementById('successText').innerText = text;
            document.getElementById('successMsg').style.display = 'flex';
        }
        window.scrollTo(0,0);
    }
</script>

</body>
</html>
